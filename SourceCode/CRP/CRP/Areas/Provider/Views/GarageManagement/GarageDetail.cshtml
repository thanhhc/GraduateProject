@model CRP.Models.ViewModels.GarageModel
@{
    ViewBag.Title = "Garage Detail";
    Layout = "~/Views/Shared/_ManagementLayout.cshtml";
}

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-md-10"><h2>Thông tin garage</h2></div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">

    <div class="col-lg-12">
        <div class="ibox float-e-margins">
            @Html.HiddenFor(q => q.ID, new { @id = "garageID" })
            @Html.HiddenFor(q => q.IsActive, new { @id = "isActive" })
            @Html.HiddenFor(q => q.Name, new { @id = "garageNameD" })
            @Html.HiddenFor(q => q.Star, new { @id = "star" })
            
            <div class="ibox-title">
                <div class="edit-control row">
                    <div class="col-md-offset-2 col-md-8">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="fa fa-building-o" style="font-size: 2em;color: #000;"></i></span>
                            @Html.TextBoxFor(q => q.Name, new { @id = "garageName", @class = "form-control input-lg", @placeholder = "Tên garage", @style = "color: #000;", required = true })
                        </div>
                    </div>
                </div>
                <div id="displayGarageName" class="display-control row">
                </div>
            </div>

            <div class="ibox-content">
                <div class="edit-control form-group">
                    <div class="row">
                        <div class="col-md-7">
                            <div class="row m-b text-center">
                                <div class="col-md-4 text-right">
                                    <label>Địa điểm <span style="color: red">*</span></label>
                                </div>
                                <div class="col-md-8 text-left">
                                    @Html.DropDownListFor(q => q.LocationID, this.Model.listLocation, new { @class = "form-control", @id="locationID" })
                                </div>
                            </div>
                            <div class="row m-b text-center">
                                <div class="col-md-4 text-right">
                                    <label>Địa chỉ <span style="color: red">*</span></label>
                                </div>
                                <div class="col-md-8 text-left">
                                    @Html.TextBoxFor(q => q.Address, new { @class = "form-control", @id="gAddress" })
                                </div>
                            </div>
                            <div class="row m-b text-center">
                                <div class="col-md-4 text-right">
                                    <label>Email <span style="color: red">*</span></label>
                                </div>
                                <div class="col-md-8 text-left">
                                    @Html.TextBoxFor(q => q.Email, new { @type = "email", @class = "form-control", @id="gEmail" })
                                </div>
                            </div>
                            <div class="row m-b text-center">
                                <div class="col-md-4 text-right">
                                    <label>Số điện thoại (mặc định) <span style="color: red">*</span></label>
                                </div>
                                <div class="col-md-8 text-left">
                                    @Html.TextBoxFor(q => q.Phone1, new { @class = "form-control", @id="gPhone1" })
                                </div>
                            </div>
                            <div class="row m-b text-center">
                                <div class="col-md-4 text-right">
                                    <label>Số điện thoại (bổ sung)</label>
                                </div>
                                <div class="col-md-8 text-left">
                                    @Html.TextBoxFor(q => q.Phone2, new { @class = "form-control", @id="gPhone2" })
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="form-group" id="workingTime">
                                <h2>Thời gian mở cửa</h2>
                                <div id="working-time-edit">
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row m-b text-center">
                                    <h3>Mô tả</h3>
                                <div class="col-md-12 text-left">
                                    @Html.TextAreaFor(q => q.Description, new { @class = "form-control", @id = "gDescription", @rows="10" })
                                </div>
                            </div>
                            <hr>
                            <div class="row m-b text-center">
                                    <h3>Điều khoản</h3>
                                <div class="col-md-12 text-left">
                                    @Html.TextAreaFor(q => q.Policy, new { @class = "form-control", @id = "gPolicy", @rows="10" })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="display-control row form-group">
                    <div class="row">
                        <div class="col-md-7">
                            <div class="row m-b text-center">
                                <div class="col-md-4 text-right">
                                    <label>Địa điểm</label>
                                </div>
                                <div class="col-md-8 text-left">
                                    @Model.Location.Name
                                </div>
                            </div>
                            <div class="row m-b text-center">
                                <div class="col-md-4 text-right">
                                    <label>Địa chỉ</label>
                                </div>
                                <div class="col-md-8 text-left">
                                    @Model.Address
                                </div>
                            </div>
                            <div class="row m-b text-center">
                                <div class="col-md-4 text-right">
                                    <label>Email</label>
                                </div>
                                <div class="col-md-8 text-left">
                                    @Model.Email
                                </div>
                            </div>
                            <div class="row m-b text-center">
                                <div class="col-md-4 text-right">
                                    <label>Số điện thoại (mặc định)</label>
                                </div>
                                <div class="col-md-8 text-left">
                                    @Model.Phone1
                                </div>
                            </div>
                            <div class="row m-b text-center">
                                <div class="col-md-4 text-right">
                                    <label>Số điện thoại (bố sung)</label>
                                </div>
                                <div class="col-md-8 text-left">
                                    @if (Model.Phone2 != null)
                                {
                                        @Model.Phone2
                                } else
                                {
                                        <text>chưa có</text>
                                }

                                </div>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="form-group" id="workingTime">
                                <h2>Thời gian mở cửa</h2>
                                <div id="working-time">
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row m-b text-center">
                                <div class="col-md-2 text-right">
                                    <label>Mô tả</label>
                                </div>
                                <div class="col-md-9 text-left">
                                    @if (Model.Description != null)
                                    {
                                        @Model.Description
                                    }
                                    else
                                    {
                                        <text>chưa có</text>
                                    }
                                </div>
                            </div>
                            <hr>
                            <div class="row m-b text-center">
                                <div class="col-md-2 text-right">
                                    <label>Điều khoản</label>
                                </div>
                                <div class="col-md-9 text-left">
                                    @if (Model.Policy != null)
                                    {
                                        @Model.Policy
                                    }
                                    else
                                    {
                                        <text>chưa có</text>
                                    }

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ibox-footer">
                <div>
                    <div class="btn-group">
                        <button id="activationBtn" class="btn btn-warning" data-toggle="modal" data-target="#customModal"></button>
                        <button class="btn btn-danger" data-toggle="modal" data-target="#customModal" data-action="deleteGarage">Xóa garage</button>
                    </div>
                    <button id="saveChange" class="edit-control btn btn-primary pull-right">Lưu lại</button>
                    <button id="cancelChange" class="edit-control btn btn-default pull-right m-r-xs">Hủy bỏ</button>
                </div>
            </div>
        </div>
    </div>
    

    <div class="tabs-container">
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#tab-vehicle">Thông tin xe</a></li>
            <li class=""><a data-toggle="tab" href="#tab-booking">Thông tin đặt xe</a></li>
        </ul>
        <div class="tab-content">
            <div id="tab-vehicle" class="tab-pane active">
                <div class="panel-body">
                    <div class="ibox ibox-content float-e-margins">
                        <div class="row">
                            <div class="pull-right">
                                <button id="listAdd" data-toggle="modal" data-target="#modalAdd" class="btn btn-success" style="margin-bottom: 1em;">
                                    <i class="fa fa-plus"></i> Thêm xe vào Garage
                                </button>
                            </div>
                        </div>
                        <table id="vehicles" class="table table-striped table-bordered table-hover" width="100%"></table>
                    </div>
                </div>
            </div>
            <div id="tab-booking" class="tab-pane">
                <div class="panel-body">
                    <div class="ibox ibox-content float-e-margins">
                        <div class="row">
                            <div class="pull-left m-r m-b table-bordered">
                                <h3>Thời gian thanh toán</h3>
                                <div class="radio">
                                    <input type="radio" id="rd1" value="all" name="bookingTime" checked>
                                    <label for="rd1"> Tất cả</label>
                                </div>
                                <div class="radio">
                                    <input type="radio" id="rd2" value="past" name="bookingTime">
                                    <label for="rd2"> Đã qua</label>
                                </div>
                                <div class="radio">
                                    <input type="radio" id="rd3" value="future" name="bookingTime">
                                    <label for="rd3"> Sắp đến</label>
                                </div>
                            </div>
                            <div class="pull-left m-r m-b table-bordered">
                                <br>
                                <div class="checkbox">
                                    <input type="checkbox" id="isCanceled" checked>
                                    <label for="isCanceled"> Hiện hóa đơn đã hủy</label>
                                </div>
                                <div class="checkbox">
                                    <input type="checkbox" id="isSelfBooking" checked>
                                    <label for="isSelfBooking"> Hiện hóa đơn tự đặt</label>
                                </div>
                                <br>
                            </div>
                        </div>
                        
                        <table class="table table-striped table-bordered table-hover" width="100%" id="bookings"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="customModal" tabindex="-1" role="dialog"></div>

<div id="detailBooking" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Thông tin đặt xe</h4>
            </div>
            <div class="modal-body">
                <div class="ibox">
                    <div class="ibox-title">Thông tin khách hàng</div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-2 text-right">
                                <label>Tên khách hàng</label>
                            </div>
                            <div id="customerName" class="col-md-4 text-center"></div>

                            <div class="col-md-2 text-right">
                                <label>Email liên hệ</label>
                            </div>
                            <div id="customerEmail" class="col-md-4 text-center"></div>
                            <div class="col-md-offset-6 col-md-2 text-right">
                                <label>Số điện thoại</label>
                            </div>
                            <div id="customerPhone" class="col-md-4 text-center"></div>
                        </div>
                    </div>
                </div>

                <div class="ibox">
                    <div class="ibox-title">Thông tin xe cho thuê</div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-2 text-right">
                                <label>Tên xe</label>
                            </div>
                            <div id="vehicleName" class="col-md-4 text-center"></div>

                            <div class="col-md-2 text-right">
                                <label>Biển số xe</label>
                            </div>
                            <div id="licenseNumber" class="col-md-4 text-center"></div>
                        </div>
                    </div>
                </div>

                <div class="ibox">
                    <div class="ibox-title">Nội dung đặt xe chi tiết</div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-2 text-right">
                                <label>Giá cho thuê</label>
                            </div>
                            <div id="rentalPrice" class="col-md-4 text-center"></div>

                            <div class="col-md-2 text-right">
                                <label>Thời gian thuê</label>
                            </div>
                            <div class="col-md-4 text-center">
                                Từ <span id="startTime"></span>
                                <br>
                                Đến <span id="endTime"></span>
                            </div>
                            <div class="col-md-2 text-right">
                                <label>Tiền đặt cọc</label>
                            </div>
                            <div id="deposit" class="col-md-4 text-center"></div>

                            <div class="col-md-6">
                                <div class="row m-t">
                                    <div class="col-md-6">
                                        <label>Đánh giá và nhận xét</label>
                                    </div>
                                    <div class="col-md-6">
                                        <span id="rating"></span>
                                    </div>
                                    <div class="col-md-offset-1 col-md-10">
                                        <p id="comment"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<style>
    .select2-dropdown {
        z-index: 10060 !important; /*1051;*/
    }
</style>
<div id="modalAdd" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Thêm xe vào garage này</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-offset-1 col-md-2">
                        <label>Vui lòng chọn xe</label>
                    </div>
                    <div class="col-md-8">
                        <select class="form-control" id="drpVehicle"></select>                        
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                <button id="btnAddVehicle" class="btn btn-primary" type="button">Thêm</button>
            </div>
        </div>

    </div>
</div>

<div id="changeGarage" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Chuyển xe này đến garage khác</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-offset-1 col-md-2">
                        <label>Vui lòng chọn garage</label>
                    </div>
                    <div class="col-md-8">
                        <input type="hidden" id="v-id" />
                        <select class="form-control" id="drpGarage"></select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                <button id="btnChangeGarage" class="btn btn-primary" type="button">Đồng ý</button>
            </div>
        </div>

    </div>
</div>

<div id="cancelBooking" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header red-bg">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Hủy đặt xe</h4>
            </div>
            <div class="modal-body">
                <input type="hidden" id="br-id" />
                Bạn có chắc chắn hủy đặt xe <span id="vehicle-name"></span> trong khoảng từ <span id="start-time"></span> đến <span id="end-time"></span> không?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                <button id="btnCancelBooking" class="btn btn-danger" type="button">Đồng ý</button>
            </div>
        </div>
    </div>
</div>

@{ BundleTable.Bundles.Add(new StyleBundle("~/Styles/Garage")
                                .Include("~/Content/awesome-bootstrap-checkbox.css",
                                    "~/Content/DataTables/css/dataTables.bootstrap.css",
                                    "~/Content/select2/select2.min.css",
                                    "~/Content/jasny-bootstrap.min.css"));
}
@section Styles {
    @Styles.Render("~/Styles/Garage")
}
@section PageStyle {
    @Styles.Render("~/Content/pageStyle/garage.css")
}

@{ BundleTable.Bundles.Add(new ScriptBundle("~/Scripts/Garage")
                  .Include("~/Scripts/select2/select2.full.min.js",
                      "~/Scripts/Datatables/jquery.dataTables.js",
                      "~/Scripts/Datatables/dataTables.bootstrap.js",
                      "~/Scripts/jasny-bootstrap.min.js",
                      "~/Scripts/utils/customModals.js",
                      "~/Scripts/utils/generateUIElements.js",
                      "~/Scripts/utils/generateCustomDataTablesFilters.js",
                      "~/Scripts/pageScript/garage.js"));
}
@section Scripts {
    <script type="text/javascript">
        const queryBookingApiUrl = '@Url.RouteUrl("GetBookingListAPI", new { controller = "BookingManagement" })'
            , STAR_RATING = @Model.Star
            , NUM_OF_COMMENT = @Model.NumOfComment;
    </script>
    @Scripts.Render("~/Scripts/Garage")
}